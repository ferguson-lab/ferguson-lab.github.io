<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Wedge Billiard</title>
<!--link rel="stylesheet" href="style.css"-->
	<style>
	body {
	  background-color: #666;
	}
	#canvas {
	  background-color: #000;
	}
	</style>
</head>
<body>
    <div id="maindiv" style="width:1024px; margin-left:auto; margin-right:auto;">
		
		<div id="appDiv1" style="background-color:#d0d0d0; border:5px solid #d0d0d0;">
			
			<div id="controlpanel" style="float:right; width:230px; margin-left:10px; text-align:center;">
				<div style="margin-top:5px; text-align:center;">
					theta = <input id="Nvalue" type="text" size="3" style="text-align:center" onchange="changeN(this.value)" oninput="changeN(this.value)"/><br>
				</div>
				<div style="margin-bottom:8px">
					<input id="Nslider" type="range" min="0" max="90" value="17" oninput="changeN(this.value);printValue('Nslider','Nvalue');" onchange="changeN(this.value);printValue('Nslider','Nvalue');">
				</div>
				<!--div style="margin-top:5px; text-align:center;">
					number of molecules = <input id="numBallvalue" type="text" size="3" style="text-align:center" onchange="changeNumball(this.value)" oninput="changeNumball(this.value)"/><br>
					(up to 10,000, use textbox above 100)
				</div>
				<div style="margin-bottom:8px">
					<input id="numBallsslider" type="range" min="0" max="100" value="40" oninput="changeNumball(this.value);printValue('numBallsslider','numBallvalue');" onchange="changeNumball(this.value);printValue('numBallsslider','numBallvalue');">
				</div>
				<div style="margin-top:5px; text-align:center;">
					diffusion coefficient = 
					<span id="Dvalue"></span>
				</div>
				<div>
					<input id="Dslider" type="range" min="0" max="50" value="10" oninput="changeD(this.value)" onchange="changeD(this.value)">
				</div><br>
				<div style="margin-top:5px; text-align:center;">
					Molecular Brightness<br>(photons/molecule/second)<br>
					green&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red<br>
					&nbsp;&nbsp;<input id="greenBrightness" type="text" size="1" value="1" style="text-align:center" onchange="changegreenBrightness(this.value)" oninput="changegreenBrightness(this.value)"/>
					:&nbsp;<input id="redBrightness" type="text" size="1" value="1" style="text-align:center" onchange="changeredBrightness(this.value)"oninput="changeredBrightness(this.value)"/>
				</div><br>
				<div style="margin-top:5px; text-align:center;">
					Stoichimoetry<br>
					green&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red<br>
					&nbsp;&nbsp;<input id="greenStoichiometry" type="text" size="1" value="1" style="text-align:center" onchange="changegreenStoichiometry(this.value)" oninput="changegreenStoichiometry(this.value)"/>
					:&nbsp;<input id="redStoichiometry" type="text" size="1" value="1" style="text-align:center" onchange="changeredStoichiometry(this.value)" oninput="changeredStoichiometry(this.value)"/>
				</div><br-->
				<div style="margin-top:8px;text-align:center;">
					Background Color:
					<select id="bgSelect" onchange="changeBg()">
						<option value="White" selected>White</option>
						<option value="Black">Black</option>
						<option value="Red">Red</option>
						<option value="Blue">Blue</option>
						<option value="Green">Green</option>
					</select>
				</div> <br>
				<div>
				<input type="button" onclick="reinit()" value="reset"/>
				</div>
			</div>
			
			<!--div id="canvasdiv" style="width:512px; position:relative;"-->
			<div id="canvasdiv" style="width:768px; position:relative;">
			
				<canvas id="canvas" width="768px" height="640px" style=
				"background-color:#000;">Canvas not supported; please update your browser.</canvas>
				
				<!--canvas id="chart1" width="512px" height="128px" style="background-color:#fff;"></canvas>
				
				<canvas id="chart2" width="512px" height="128px" style="background-color:#fff;"></canvas-->
			</div>
					
		</div>
<!--script src= "control_panel.js"></script-->
	<script>
	var canvas = document.getElementById('canvas');
	var context = canvas.getContext('2d'); 

	function reinit(){
		with(context){
			clearRect(0, 0, canvas.width, canvas.height);
		}		
	}
	/*	
	function changegreenStoichiometry(newgreenStoichiometry){
		document.getElementById("greenStoichiometry").innerHTML=newgreenStoichiometry;
		stoichiometry_green=newgreenStoichiometry;
	}
	function changeredStoichiometry(newredStoichiometry){
		document.getElementById("redStoichiometry").innerHTML=newredStoichiometry;
		stoichiometry_red=newredStoichiometry;
	}
	function changegreenBrightness(newlambda_green) {
		document.getElementById("greenBrightness").innerHTML=newlambda_green;
		lambda_green=newlambda_green;
	}
	function changeredBrightness(newlambda_red) {
		document.getElementById("redBrightness").innerHTML=newlambda_red;
		lambda_red=newlambda_red;
	}
	function changeD(newD){
		document.getElementById("Dvalue").innerHTML=newD;
		D=newD;
	}		
	function changeNumball(newNumball){
		document.getElementById("numBallvalue").innerHTML=newNumball;
		numBalls=newNumball;
	}
	*/
	function changeBg() {
		document.getElementById('canvas').style.backgroundColor=document.getElementById('bgSelect').value;
		document.getElementById('chart2').style.backgroundColor=document.getElementById('bgSelect').value;
	}
	function changeN(newN){
		with(context){
			clearRect(0, 0, canvas.width, canvas.height);
		}
		index=0
		document.getElementById("Nvalue").innerHTML=newN;
		N=newN;
		theta=N/180*Math.PI;
		alpha=Math.tan(theta);
		chi=(1-alpha**2)/(1+alpha**2)**2;
		ct=Math.cos(theta);
		st2=Math.sin(theta)**2;

	}
	function printValue(sliderID,textbox) {
		var p=document.getElementById(textbox);
		var q=document.getElementById(sliderID);
		p.value=q.value;
	}
	</script>
<!--script src= "wedge.js"></script-->
	<script>
		var canvas = document.getElementById('canvas');
		var context = canvas.getContext('2d'); 

		//var radius = 1;
		var color = "#fff000";
		var x = 0;
		var y = 0;
		var X = 0;
		var Z = 0;
		var N = 17;
		var theta=N/180*Math.PI;
		var alpha=Math.tan(theta);
		var chi=(1-alpha**2)/(1+alpha**2)**2;
		var ct=Math.cos(theta);
		var st2=Math.sin(theta)**2;

		 
		window.onload = init; 
		 
		function init() {
		  setInterval(onEachStep,0); // 60 fps
		  
		  document.getElementById("Nvalue").innerHTML=N;
		  changeN(document.getElementById("Nslider").value);
		  //changeN(document.getElementById("Nvalue").value);
		  printValue('Nslider','Nvalue');				
		};

		function getMousePos(canvas, evt) {
		  var rect = canvas.getBoundingClientRect();
		  return {
			x: evt.clientX - rect.left,
			y: evt.clientY - rect.top
		  };
		}

		document.addEventListener("click", (event) => {
		//    X = 2*(event.clientX/canvas.width-0.5)/Math.cos(theta);
		//    Z = (1-event.clientY/canvas.height)/Math.sin(theta)**2;
			pos=getMousePos(canvas,event);
			X = 2*(pos.x/canvas.width-0.5)/Math.cos(theta);
			Z = (1-pos.y/canvas.height)/Math.sin(theta)**2;
			console.log(`Mouse X: ${X}, Mouse Y: ${Z}`);
		});

		document.addEventListener("click", changecolor);
		let index = 0;
		const colors = {
		  red: "#FF0000",
		  orange: "#FF7F00",
		  yellow: "FFFF00",
		  green: "#00FF00",
		  aqua: "#00FFFF",
		  blue: "#00F0FF",
		  purple: "#8B00FF",
		};

		function changecolor() {
		  const keys = Object.keys(colors);
		  //document.body.style.backgroundColor = colors[keys[index]];
		  color = colors[keys[index]];
		  index = index < keys.length - 1 ? index + 1 : 0;
		} 
		function onEachStep() {
		  [X,Z]=T(X,Z);
		  draw_point(); // draw the ball
		};
		 
		function draw_point() {
			with (context){
				x=0.5*(X*ct+1)*canvas.width;
				y=(1-Z*st2)*canvas.height;
				fillStyle = color;
				beginPath();
				fillRect(x, y, 1, 1); // fillRect is supposted to be faster than arc
				closePath();
				fill();
			};
		};

		function T(X,Z) {
			var X,Y,Z;
			var X1,Y1,Z1;
			Y=Math.sqrt(Z);
			function f(X,Y) {
				var X,Y;
				return ((X-2*Y)*ct)**2+(Y)**2*st2
			};
			if (f(X,Y)<=1){
				Y1=Y;
				X1=X-2*Y;
				Z1=Y1**2;
				return [X1,Z1];
			} else {
				Y1=Math.sqrt(2+2*chi*(Y-X)**2-Y**2);
				X1=Y-X-Y1;
				Z1=Y1**2;
				return [X1,Z1];
			};
		};
	</script>
	<font color="grey">
		<p>Copyright 2025 Matthew Lee Ferguson</p>
		<p><a rel="license" href="http://www.gnu.org/licenses/"><img alt="GNU General Public License as published by
		the Free Software Foundation" style="border-width:0" src="https://www.gnu.org/graphics/heckert_gnu.small.png" /></a><br />
		<span xmlns:dct="https://www.gnu.org/licenses/gpl.html" property="dct:title">Javascript &#956Lecture Demonstrations</span> by <a xmlns:cc="https://www.gnu.org/licenses/" href="https://www.boisestate.edu/physics/faculty-and-staff/faculty/ferguson/" property="cc:attributionName" rel="cc:attributionURL">Matthew Lee Ferguson</a> is licensed under a <a rel="license" href="https://www.gnu.org/licenses/gpl.html">GNU General Public License as published by
		the Free Software Foundation</a>.<br />
		Based on work done at <a href="https://www.boisestate.edu/physics/faculty-and-staff/faculty/ferguson/">https://www.boisestate.edu/physics/faculty-and-staff/faculty/ferguson/</a>.<br />
	</font></p>
</body>
</html>